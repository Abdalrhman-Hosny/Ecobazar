<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../Style/checkout.css" type="text/css">
    <link rel="stylesheet" href="../Logic/checkOut.java">
    <title>Checkout Page</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bungee+Spice&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <!-- Add this script section to your CheckOut.html before the closing </body> tag -->

</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <section class="billing-section">
                    <form action="">
                        <h3 class="title">Billing Information</h3>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="name" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="name" name="name" required placeholder="First Name">
                            </div>
                            <div class="col-md-4">
                                <label for="lastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="lastName" name="lastName" required placeholder="Last Name">
                            </div>
                            <div class="col-md-4">
                                <label for="companyName" class="form-label">Company Name</label>
                                <input type="text" class="form-control" id="companyName" name="companyName" placeholder="Company Name">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-12">
                                <label for="streetAddress" class="form-label">Street Address</label>
                                <input type="text" class="form-control" id="streetAddress" name="streetAddress" required placeholder="Street Address">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="country" class="form-label">Country/Region</label>
                                <select id="country" class="form-select">
                                    <option value="EGYPT">Egypt</option>
                                    <option value="Palastine">Palestine</option>
                                    <option value="Morocoo">Morocco</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="state" class="form-label">State</label>
                                <select id="state" class="form-select">
                                    <option value="CAIRO">Cairo</option>
                                    <option value="Palastine">Palestine</option>
                                    <option value="Morocoo">Morocco</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="zipCode" class="form-label">Zip Code</label>
                                <input type="text" class="form-control" id="zipCode" name="zipCode" required placeholder="Zip Code">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email" required placeholder="Email Address">
                            </div>
                            <div class="col-md-6">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="text" class="form-control" id="phone" name="phone" required placeholder="Phone Number">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="differentAddress">
                                    <label class="form-check-label" for="differentAddress">
                                        Ship to a different address
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <h3 class="title">Additional Info</h3>
                        <div class="row mb-3">
                            <div class="col-12">
                                <label for="orderNotes" class="form-label">Order Notes (Optional)</label>
                                <textarea class="form-control" id="orderNotes" name="orderNotes" placeholder="Notes about your order, e.g. special notes for delivery"></textarea>
                            </div>
                        </div>
                    </form>
                </section>
            </div>
            
            <div class="col-lg-4">
                <section class="summary-section">
                    <h3>Order Summary</h3>
                    
                    <div class="order-items">
                        <div class="item">
                            <span>Green Capsicum x5</span>
                            <span>$70.00</span>
                        </div>
                        <div class="item">
                            <span>Red Capsicum x1</span>
                            <span>$14.00</span>
                        </div>
                    </div>
                    
                    <div class="price-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span>$84.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping:</span>
                            <span>Free</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total:</span>
                            <span>$84.00</span>
                        </div>
                    </div>
                    
                    <h3>Payment Method</h3>
                    <div class="payment-methods">
                        <div class="payment-option">
                            <input class="form-check-input" type="radio" id="cod" name="payment" value="cod" checked>
                            <label class="form-check-label" for="cod">Cash on Delivery</label>
                        </div>
                        <div class="payment-option">
                            <input class="form-check-input" type="radio" id="paypal" name="payment" value="paypal">
                            <label class="form-check-label" for="paypal">Paypal</label>
                        </div>
                        <div class="payment-option">
                            <input class="form-check-input" type="radio" id="amazon" name="payment" value="amazon">
                            <label class="form-check-label" for="amazon">Amazon Pay</label>
                        </div>
                    </div>
                    
                    <button class="submit-btn">Place Order</button>
                </section>
            </div>
        </div>
    </div>
    <script>
        // Cart functionality
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        function updateOrderSummary() {
            const orderItemsContainer = document.querySelector('.order-items');
            const subtotalElement = document.querySelector('.price-summary .summary-row:first-child span:last-child');
            
            // Clear existing items
            orderItemsContainer.innerHTML = '';
            
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                itemElement.innerHTML = `
                    <span>${item.name} x${item.quantity}</span>
                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                `;
                orderItemsContainer.appendChild(itemElement);
                
                subtotal += item.price * item.quantity;
            });
            
            // Update subtotal
            subtotalElement.textContent = `$${subtotal.toFixed(2)}`;
            
            // Update total (assuming free shipping)
            document.querySelector('.price-summary .total span:last-child').textContent = `$${subtotal.toFixed(2)}`;
        }
        
        // Handle form submission
        document.querySelector('.submit-btn').addEventListener('click', async (e) => {
            e.preventDefault();
            
            const orderData = {
                customer: {
                    firstName: document.getElementById('name').value,
                    lastName: document.getElementById('lastName').value,
                    companyName: document.getElementById('companyName').value,
                    streetAddress: document.getElementById('streetAddress').value,
                    country: document.getElementById('country').value,
                    state: document.getElementById('state').value,
                    zipCode: document.getElementById('zipCode').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                },
                items: cart,
                paymentMethod: document.querySelector('input[name="payment"]:checked').value,
                notes: document.getElementById('orderNotes').value
            };
            
            try {
                // For Java backend
                const response = await fetch('http://localhost:8080/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                // For PHP backend alternative
                // const response = await fetch('checkout.php', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //     },
                //     body: JSON.stringify(orderData)
                // });
                
                if (response.ok) {
                    const result = await response.json();
                    alert('Order placed successfully!');
                    localStorage.removeItem('cart');
                    window.location.href = 'order-confirmation.html?id=' + result.orderId;
                } else {
                    throw new Error('Failed to place order');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to place order. Please try again.');
            }
        });
        
        // Initialize the order summary
        updateOrderSummary();
    </script>
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>